const { MessageEmbed } = require('discord.js');
/*
The HELP command is used to display every command's name and description
to the user, so that he may see what commands are available. The help
command is also filtered by level, so if a user does not have access to
a command, it is not shown to them. If a command name is given with the
help command, its extended help is shown.
*/
exports.run = (client, message, args, level) => {
    // If no specific command is called, show all filtered commands.
    if (!args[0]) {
        // Filter all commands by which are available for the user's level, using the <Collection>.filter() method.
        const myCommands = message.guild
            ? client.commands.filter((cmd) => client.levelCache[cmd.conf.permLevel] <= level)
            : client.commands.filter((cmd) => client.levelCache[cmd.conf.permLevel] <= level &&
                cmd.conf.guildOnly !== true);
        let currentCategory = '';
        let fields = [];
        let fieldsNum = 0;
        const sorted = myCommands
            .array()
            .sort((p, c) => p.help.category > c.help.category
            ? 1
            : p.help.name > c.help.name &&
                p.help.category === c.help.category
                ? 1
                : -1);
        sorted.forEach((c) => {
            const cat = c.help.category.toProperCase();
            if (currentCategory !== cat) {
                if (currentCategory !== '')
                    fieldsNum += 1;
                fields[fieldsNum] = { name: `${cat}`, value: '' };
                currentCategory = cat;
            }
            fields[fieldsNum].value += `${message.settings.prefix}${c.help.name} - ${c.help.description}\n`;
        });
        const embed = new MessageEmbed()
            .setTitle('Command list')
            .setColor(message.settings.embedColor)
            .setDescription(`**Use ${message.settings.prefix}help <commandname> for details**`)
            .addFields(fields)
            .setTimestamp();
        message.channel.send(embed);
    }
    else {
        // Show individual command's help.
        let command = args[0];
        if (client.commands.has(command)) {
            command = client.commands.get(command);
            if (level < client.levelCache[command.conf.permLevel])
                return;
            const embed = new MessageEmbed()
                .setTitle('Command list')
                .setColor(message.settings.embedColor)
                .addFields({
                name: 'Description:',
                value: command.help.description,
            }, { name: 'Usage:', value: command.help.usage }, { name: 'Aliases:', value: command.conf.aliases.join(', ') })
                .setTimestamp();
            message.channel.send(embed);
        }
    }
};
exports.conf = {
    enabled: true,
    guildOnly: false,
    aliases: ['h', 'halp'],
    permLevel: 'User',
};
exports.help = {
    name: 'help',
    category: 'System',
    description: 'Displays all the available commands for your permission level.',
    usage: 'help [command]',
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9oZWxwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sRUFBRSxZQUFZLEVBQUUsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFL0M7Ozs7OztFQU1FO0FBRUYsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO0lBQzNDLGdFQUFnRTtJQUNoRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQ1YsMkdBQTJHO1FBQzNHLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxLQUFLO1lBQzVCLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FDbEIsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxLQUFLLENBQzFEO1lBQ0gsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUNsQixDQUFDLEdBQUcsRUFBRSxFQUFFLENBQ0osTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUs7Z0JBQzlDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLElBQUksQ0FDbEMsQ0FBQztRQUVSLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sTUFBTSxHQUFHLFVBQVU7YUFDcEIsS0FBSyxFQUFFO2FBQ1AsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQ1gsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQzdCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSTtnQkFDekIsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRO2dCQUNyQyxDQUFDLENBQUMsQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ1gsQ0FBQztRQUNOLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNqQixNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUMzQyxJQUFJLGVBQWUsS0FBSyxHQUFHLEVBQUU7Z0JBQ3pCLElBQUksZUFBZSxLQUFLLEVBQUU7b0JBQUUsU0FBUyxJQUFJLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDO2dCQUNsRCxlQUFlLEdBQUcsR0FBRyxDQUFDO2FBQ3pCO1lBQ0QsTUFBTSxDQUNGLFNBQVMsQ0FDWixDQUFDLEtBQUssSUFBSSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUM7UUFDcEYsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLEtBQUssR0FBRyxJQUFJLFlBQVksRUFBRTthQUMzQixRQUFRLENBQUMsY0FBYyxDQUFDO2FBQ3hCLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQzthQUNyQyxjQUFjLENBQ1gsU0FBUyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sa0NBQWtDLENBQ3JFO2FBQ0EsU0FBUyxDQUFDLE1BQU0sQ0FBQzthQUNqQixZQUFZLEVBQUUsQ0FBQztRQUNwQixPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUMvQjtTQUFNO1FBQ0gsa0NBQWtDO1FBQ2xDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0QixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQzlCLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN2QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUFFLE9BQU87WUFDOUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFZLEVBQUU7aUJBQzNCLFFBQVEsQ0FBQyxjQUFjLENBQUM7aUJBQ3hCLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztpQkFDckMsU0FBUyxDQUNOO2dCQUNJLElBQUksRUFBRSxjQUFjO2dCQUNwQixLQUFLLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXO2FBQ2xDLEVBQ0QsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUM3QyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUMvRDtpQkFDQSxZQUFZLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMvQjtLQUNKO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsT0FBTyxDQUFDLElBQUksR0FBRztJQUNYLE9BQU8sRUFBRSxJQUFJO0lBQ2IsU0FBUyxFQUFFLEtBQUs7SUFDaEIsT0FBTyxFQUFFLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQztJQUN0QixTQUFTLEVBQUUsTUFBTTtDQUNwQixDQUFDO0FBRUYsT0FBTyxDQUFDLElBQUksR0FBRztJQUNYLElBQUksRUFBRSxNQUFNO0lBQ1osUUFBUSxFQUFFLFFBQVE7SUFDbEIsV0FBVyxFQUNQLGdFQUFnRTtJQUNwRSxLQUFLLEVBQUUsZ0JBQWdCO0NBQzFCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IE1lc3NhZ2VFbWJlZCB9ID0gcmVxdWlyZSgnZGlzY29yZC5qcycpO1xuXG4vKlxuVGhlIEhFTFAgY29tbWFuZCBpcyB1c2VkIHRvIGRpc3BsYXkgZXZlcnkgY29tbWFuZCdzIG5hbWUgYW5kIGRlc2NyaXB0aW9uXG50byB0aGUgdXNlciwgc28gdGhhdCBoZSBtYXkgc2VlIHdoYXQgY29tbWFuZHMgYXJlIGF2YWlsYWJsZS4gVGhlIGhlbHBcbmNvbW1hbmQgaXMgYWxzbyBmaWx0ZXJlZCBieSBsZXZlbCwgc28gaWYgYSB1c2VyIGRvZXMgbm90IGhhdmUgYWNjZXNzIHRvXG5hIGNvbW1hbmQsIGl0IGlzIG5vdCBzaG93biB0byB0aGVtLiBJZiBhIGNvbW1hbmQgbmFtZSBpcyBnaXZlbiB3aXRoIHRoZVxuaGVscCBjb21tYW5kLCBpdHMgZXh0ZW5kZWQgaGVscCBpcyBzaG93bi5cbiovXG5cbmV4cG9ydHMucnVuID0gKGNsaWVudCwgbWVzc2FnZSwgYXJncywgbGV2ZWwpID0+IHtcbiAgICAvLyBJZiBubyBzcGVjaWZpYyBjb21tYW5kIGlzIGNhbGxlZCwgc2hvdyBhbGwgZmlsdGVyZWQgY29tbWFuZHMuXG4gICAgaWYgKCFhcmdzWzBdKSB7XG4gICAgICAgIC8vIEZpbHRlciBhbGwgY29tbWFuZHMgYnkgd2hpY2ggYXJlIGF2YWlsYWJsZSBmb3IgdGhlIHVzZXIncyBsZXZlbCwgdXNpbmcgdGhlIDxDb2xsZWN0aW9uPi5maWx0ZXIoKSBtZXRob2QuXG4gICAgICAgIGNvbnN0IG15Q29tbWFuZHMgPSBtZXNzYWdlLmd1aWxkXG4gICAgICAgICAgICA/IGNsaWVudC5jb21tYW5kcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgICAoY21kKSA9PiBjbGllbnQubGV2ZWxDYWNoZVtjbWQuY29uZi5wZXJtTGV2ZWxdIDw9IGxldmVsXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIDogY2xpZW50LmNvbW1hbmRzLmZpbHRlcihcbiAgICAgICAgICAgICAgICAgIChjbWQpID0+XG4gICAgICAgICAgICAgICAgICAgICAgY2xpZW50LmxldmVsQ2FjaGVbY21kLmNvbmYucGVybUxldmVsXSA8PSBsZXZlbCAmJlxuICAgICAgICAgICAgICAgICAgICAgIGNtZC5jb25mLmd1aWxkT25seSAhPT0gdHJ1ZVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgIGxldCBjdXJyZW50Q2F0ZWdvcnkgPSAnJztcbiAgICAgICAgbGV0IGZpZWxkcyA9IFtdO1xuICAgICAgICBsZXQgZmllbGRzTnVtID0gMDtcbiAgICAgICAgY29uc3Qgc29ydGVkID0gbXlDb21tYW5kc1xuICAgICAgICAgICAgLmFycmF5KClcbiAgICAgICAgICAgIC5zb3J0KChwLCBjKSA9PlxuICAgICAgICAgICAgICAgIHAuaGVscC5jYXRlZ29yeSA+IGMuaGVscC5jYXRlZ29yeVxuICAgICAgICAgICAgICAgICAgICA/IDFcbiAgICAgICAgICAgICAgICAgICAgOiBwLmhlbHAubmFtZSA+IGMuaGVscC5uYW1lICYmXG4gICAgICAgICAgICAgICAgICAgICAgcC5oZWxwLmNhdGVnb3J5ID09PSBjLmhlbHAuY2F0ZWdvcnlcbiAgICAgICAgICAgICAgICAgICAgPyAxXG4gICAgICAgICAgICAgICAgICAgIDogLTFcbiAgICAgICAgICAgICk7XG4gICAgICAgIHNvcnRlZC5mb3JFYWNoKChjKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjYXQgPSBjLmhlbHAuY2F0ZWdvcnkudG9Qcm9wZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAoY3VycmVudENhdGVnb3J5ICE9PSBjYXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENhdGVnb3J5ICE9PSAnJykgZmllbGRzTnVtICs9IDE7XG4gICAgICAgICAgICAgICAgZmllbGRzW2ZpZWxkc051bV0gPSB7IG5hbWU6IGAke2NhdH1gLCB2YWx1ZTogJycgfTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2F0ZWdvcnkgPSBjYXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaWVsZHNbXG4gICAgICAgICAgICAgICAgZmllbGRzTnVtXG4gICAgICAgICAgICBdLnZhbHVlICs9IGAke21lc3NhZ2Uuc2V0dGluZ3MucHJlZml4fSR7Yy5oZWxwLm5hbWV9IC0gJHtjLmhlbHAuZGVzY3JpcHRpb259XFxuYDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGVtYmVkID0gbmV3IE1lc3NhZ2VFbWJlZCgpXG4gICAgICAgICAgICAuc2V0VGl0bGUoJ0NvbW1hbmQgbGlzdCcpXG4gICAgICAgICAgICAuc2V0Q29sb3IobWVzc2FnZS5zZXR0aW5ncy5lbWJlZENvbG9yKVxuICAgICAgICAgICAgLnNldERlc2NyaXB0aW9uKFxuICAgICAgICAgICAgICAgIGAqKlVzZSAke21lc3NhZ2Uuc2V0dGluZ3MucHJlZml4fWhlbHAgPGNvbW1hbmRuYW1lPiBmb3IgZGV0YWlscyoqYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmFkZEZpZWxkcyhmaWVsZHMpXG4gICAgICAgICAgICAuc2V0VGltZXN0YW1wKCk7XG4gICAgICAgIG1lc3NhZ2UuY2hhbm5lbC5zZW5kKGVtYmVkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTaG93IGluZGl2aWR1YWwgY29tbWFuZCdzIGhlbHAuXG4gICAgICAgIGxldCBjb21tYW5kID0gYXJnc1swXTtcbiAgICAgICAgaWYgKGNsaWVudC5jb21tYW5kcy5oYXMoY29tbWFuZCkpIHtcbiAgICAgICAgICAgIGNvbW1hbmQgPSBjbGllbnQuY29tbWFuZHMuZ2V0KGNvbW1hbmQpO1xuICAgICAgICAgICAgaWYgKGxldmVsIDwgY2xpZW50LmxldmVsQ2FjaGVbY29tbWFuZC5jb25mLnBlcm1MZXZlbF0pIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IGVtYmVkID0gbmV3IE1lc3NhZ2VFbWJlZCgpXG4gICAgICAgICAgICAgICAgLnNldFRpdGxlKCdDb21tYW5kIGxpc3QnKVxuICAgICAgICAgICAgICAgIC5zZXRDb2xvcihtZXNzYWdlLnNldHRpbmdzLmVtYmVkQ29sb3IpXG4gICAgICAgICAgICAgICAgLmFkZEZpZWxkcyhcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0Rlc2NyaXB0aW9uOicsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY29tbWFuZC5oZWxwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IG5hbWU6ICdVc2FnZTonLCB2YWx1ZTogY29tbWFuZC5oZWxwLnVzYWdlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgbmFtZTogJ0FsaWFzZXM6JywgdmFsdWU6IGNvbW1hbmQuY29uZi5hbGlhc2VzLmpvaW4oJywgJykgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAuc2V0VGltZXN0YW1wKCk7XG4gICAgICAgICAgICBtZXNzYWdlLmNoYW5uZWwuc2VuZChlbWJlZCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5leHBvcnRzLmNvbmYgPSB7XG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICBndWlsZE9ubHk6IGZhbHNlLFxuICAgIGFsaWFzZXM6IFsnaCcsICdoYWxwJ10sXG4gICAgcGVybUxldmVsOiAnVXNlcicsXG59O1xuXG5leHBvcnRzLmhlbHAgPSB7XG4gICAgbmFtZTogJ2hlbHAnLFxuICAgIGNhdGVnb3J5OiAnU3lzdGVtJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgJ0Rpc3BsYXlzIGFsbCB0aGUgYXZhaWxhYmxlIGNvbW1hbmRzIGZvciB5b3VyIHBlcm1pc3Npb24gbGV2ZWwuJyxcbiAgICB1c2FnZTogJ2hlbHAgW2NvbW1hbmRdJyxcbn07XG4iXX0=