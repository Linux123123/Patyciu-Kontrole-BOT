module.exports = async (client, message) => {
    if (message.author.bot)
        return; // Don't listen to yourself
    const settings = (message.settings = client.getSettings(message.guild)); // Grab the settings for this server
    // Checks if the bot was mentioned, with no message after it, returns the prefix.
    const prefixMention = new RegExp(`^<@!?${client.user.id}>( |)$`);
    if (message.content.match(prefixMention)) {
        return message.reply(`My prefix is \`${settings.prefix}\``);
    }
    if (message.channel.id === settings.musicChannelId) {
        if (message.content.indexOf(settings.prefix) !== 0) {
            message.channel.bulkDelete(1);
            const args = message.content.trim();
            client.player.play(message, args, true);
            const level = client.permlevel(message);
            client.logger.cmd(`${client.config.permLevels.find((l) => l.level === level).name} ${message.author.username} (${message.author.id}) ran command play`);
        }
    }
    if (message.content.indexOf(settings.prefix) !== 0)
        return; // Ignore without prefix
    // Get command and split all the arguments
    const args = message.content
        .slice(settings.prefix.length)
        .trim()
        .split(/ +/g);
    const command = args.shift().toLowerCase();
    // If the member on a guild is invisible or not cached, fetch them.
    if (message.guild && !message.member)
        await message.guild.members.fetch(message.author);
    // Get the user or member's permission level from the elevation
    const level = client.permlevel(message);
    // Check whether the command, or alias, exist
    const cmd = client.commands.get(command) ||
        client.commands.get(client.aliases.get(command));
    if (!cmd)
        return;
    // Some commands may not be useable in DMs. This check prevents those commands from running.
    if (cmd && !message.guild && cmd.conf.guildOnly)
        return message.channel.send('This command is unavailable via private message. Please run this command in a guild.');
    // Check permissions
    if (level < client.levelCache[cmd.conf.permLevel]) {
        if (settings.systemNotice === 'true') {
            return message.channel
                .send(`You do not have permission to use this command.
  Your permission level is ${level} (${client.config.permLevels.find((l) => l.level === level).name})
  This command requires level ${client.levelCache[cmd.conf.permLevel]} (${cmd.conf.permLevel})`);
        }
        else {
            return;
        }
    }
    // Assign author perms level to level
    message.author.permLevel = level;
    message.flags = [];
    while (args[0] && args[0][0] === '-') {
        message.flags.push(args.shift().slice(1));
    }
    // If the command exists, **AND** the user has permission, run it.
    client.logger.cmd(`${client.config.permLevels.find((l) => l.level === level).name} ${message.author.username} (${message.author.id}) ran command ${cmd.help.name}`);
    cmd.run(client, message, args, level);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ldmVudHMvbWVzc2FnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLENBQUMsT0FBTyxHQUFHLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7SUFDdkMsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUc7UUFBRSxPQUFPLENBQUMsMkJBQTJCO0lBQzNELE1BQU0sUUFBUSxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsb0NBQW9DO0lBRTdHLGlGQUFpRjtJQUNqRixNQUFNLGFBQWEsR0FBRyxJQUFJLE1BQU0sQ0FBQyxRQUFRLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNqRSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1FBQ3RDLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsUUFBUSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7S0FDL0Q7SUFFRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLFFBQVEsQ0FBQyxjQUFjLEVBQUU7UUFDaEQsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2hELE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4QyxNQUFNLEtBQUssR0FBRyxN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QUMsQ0FBQztLQUM3QztJQUNELGtFQUFrRTtJQUNsRSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsQ0FBQyxJQUFJLElBQzNELE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFDbkIsS0FBSyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsaUJBQWlCLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQ3pELENBQUM7SUFDRixHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGNsaWVudCwgbWVzc2FnZSkgPT4ge1xuICAgIGlmIChtZXNzYWdlLmF1dGhvci5ib3QpIHJldHVybjsgLy8gRG9uJ3QgbGlzdGVuIHRvIHlvdXJzZWxmXG4gICAgY29uc3Qgc2V0dGluZ3MgPSAobWVzc2FnZS5zZXR0aW5ncyA9IGNsaWVudC5nZXRTZXR0aW5ncyhtZXNzYWdlLmd1aWxkKSk7IC8vIEdyYWIgdGhlIHNldHRpbmdzIGZvciB0aGlzIHNlcnZlclxuXG4gICAgLy8gQ2hlY2tzIGlmIHRoZSBib3Qgd2FzIG1lbnRpb25lZCwgd2l0aCBubyBtZXNzYWdlIGFmdGVyIGl0LCByZXR1cm5zIHRoZSBwcmVmaXguXG4gICAgY29uc3QgcHJlZml4TWVudGlvbiA9IG5ldyBSZWdFeHAoYF48QCE/JHtjbGllbnQudXNlci5pZH0+KCB8KSRgKTtcbiAgICBpZiAobWVzc2FnZS5jb250ZW50Lm1hdGNoKHByZWZpeE1lbnRpb24pKSB7XG4gICAgICAgIHJldHVybiBtZXNzYWdlLnJlcGx5KGBNeSBwcmVmaXggaXMgXFxgJHtzZXR0aW5ncy5wcmVmaXh9XFxgYCk7XG4gICAgfVxuXG4gICAgaWYgKG1lc3NhZ2UuY2hhbm5lbC5pZCA9PT0gc2V0dGluZ3MubXVzaWNDaGFubmVsSWQpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UuY29udGVudC5pbmRleE9mKHNldHRpbmdzLnByZWZpeCkgIT09IDApIHtcbiAgICAgICAgICAgIG1lc3NhZ2UuY2hhbm5lbC5idWxrRGVsZXRlKDEpO1xuICAgICAgICAgICAgY29uc3QgYXJncyA9IG1lc3NhZ2UuY29udGVudC50cmltKCk7XG4gICAgICAgICAgICBjbGllbnQucGxheWVyLnBsYXkobWVzc2FnZSwgYXJncywgdHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBsZXZlbCA9IGNsaWVudC5wZXJtbGV2ZWwobWVzc2FnZSk7XG4gICAgICAgICAgICBjbGllbnQubG9nZ2VyLmNtZChcbiAgICAgICAgICAgICAgICBgJHtcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50LmNvbmZpZy5wZXJtTGV2ZWxzLmZpbmQoKGwpID0+IGwubGV2ZWwgPT09IGxldmVsKS5uYW1lXG4gICAgICAgICAgICAgICAgfSAke21lc3NhZ2UuYXV0aG9yLnVzZXJuYW1lfSAoJHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5hdXRob3IuaWRcbiAgICAgICAgICAgICAgICB9KSByYW4gY29tbWFuZCBwbGF5YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChtZXNzYWdlLmNvbnRlbnQuaW5kZXhPZihzZXR0aW5ncy5wcmVmaXgpICE9PSAwKSByZXR1cm47IC8vIElnbm9yZSB3aXRob3V0IHByZWZpeFxuXG4gICAgLy8gR2V0IGNvbW1hbmQgYW5kIHNwbGl0IGFsbCB0aGUgYXJndW1lbnRzXG4gICAgY29uc3QgYXJncyA9IG1lc3NhZ2UuY29udGVudFxuICAgICAgICAuc2xpY2Uoc2V0dGluZ3MucHJlZml4Lmxlbmd0aClcbiAgICAgICAgLnRyaW0oKVxuICAgICAgICAuc3BsaXQoLyArL2cpO1xuICAgIGNvbnN0IGNvbW1hbmQgPSBhcmdzLnNoaWZ0KCkudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIElmIHRoZSBtZW1iZXIgb24gYSBndWlsZCBpcyBpbnZpc2libGUgb3Igbm90IGNhY2hlZCwgZmV0Y2ggdGhlbS5cbiAgICBpZiAobWVzc2FnZS5ndWlsZCAmJiAhbWVzc2FnZS5tZW1iZXIpXG4gICAgICAgIGF3YWl0IG1lc3NhZ2UuZ3VpbGQubWVtYmVycy5mZXRjaChtZXNzYWdlLmF1dGhvcik7XG5cbiAgICAvLyBHZXQgdGhlIHVzZXIgb3IgbWVtYmVyJ3MgcGVybWlzc2lvbiBsZXZlbCBmcm9tIHRoZSBlbGV2YXRpb25cbiAgICBjb25zdCBsZXZlbCA9IGNsaWVudC5wZXJtbGV2ZWwobWVzc2FnZSk7XG5cbiAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSBjb21tYW5kLCBvciBhbGlhcywgZXhpc3RcbiAgICBjb25zdCBjbWQgPVxuICAgICAgICBjbGllbnQuY29tbWFuZHMuZ2V0KGNvbW1hbmQpIHx8XG4gICAgICAgIGNsaWVudC5jb21tYW5kcy5nZXQoY2xpZW50LmFsaWFzZXMuZ2V0KGNvbW1hbmQpKTtcbiAgICBpZiAoIWNtZCkgcmV0dXJuO1xuXG4gICAgLy8gU29tZSBjb21tYW5kcyBtYXkgbm90IGJlIHVzZWFibGUgaW4gRE1zLiBUaGlzIGNoZWNrIHByZXZlbnRzIHRob3NlIGNvbW1hbmRzIGZyb20gcnVubmluZy5cbiAgICBpZiAoY21kICYmICFtZXNzYWdlLmd1aWxkICYmIGNtZC5jb25mLmd1aWxkT25seSlcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2UuY2hhbm5lbC5zZW5kKFxuICAgICAgICAgICAgJ1RoaXMgY29tbWFuZCBpcyB1bmF2YWlsYWJsZSB2aWEgcHJpdmF0ZSBtZXNzYWdlLiBQbGVhc2UgcnVuIHRoaXMgY29tbWFuZCBpbiBhIGd1aWxkLidcbiAgICAgICAgKTtcbiAgICAvLyBDaGVjayBwZXJtaXNzaW9uc1xuICAgIGlmIChsZXZlbCA8IGNsaWVudC5sZXZlbENhY2hlW2NtZC5jb25mLnBlcm1MZXZlbF0pIHtcbiAgICAgICAgaWYgKHNldHRpbmdzLnN5c3RlbU5vdGljZSA9PT0gJ3RydWUnKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5jaGFubmVsXG4gICAgICAgICAgICAgICAgLnNlbmQoYFlvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHVzZSB0aGlzIGNvbW1hbmQuXG4gIFlvdXIgcGVybWlzc2lvbiBsZXZlbCBpcyAke2xldmVsfSAoJHtcbiAgICAgICAgICAgICAgICBjbGllbnQuY29uZmlnLnBlcm1MZXZlbHMuZmluZCgobCkgPT4gbC5sZXZlbCA9PT0gbGV2ZWwpLm5hbWVcbiAgICAgICAgICAgIH0pXG4gIFRoaXMgY29tbWFuZCByZXF1aXJlcyBsZXZlbCAke2NsaWVudC5sZXZlbENhY2hlW2NtZC5jb25mLnBlcm1MZXZlbF19ICgke1xuICAgICAgICAgICAgICAgIGNtZC5jb25mLnBlcm1MZXZlbFxuICAgICAgICAgICAgfSlgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFzc2lnbiBhdXRob3IgcGVybXMgbGV2ZWwgdG8gbGV2ZWxcbiAgICBtZXNzYWdlLmF1dGhvci5wZXJtTGV2ZWwgPSBsZXZlbDtcblxuICAgIG1lc3NhZ2UuZmxhZ3MgPSBbXTtcbiAgICB3aGlsZSAoYXJnc1swXSAmJiBhcmdzWzBdWzBdID09PSAnLScpIHtcbiAgICAgICAgbWVzc2FnZS5mbGFncy5wdXNoKGFyZ3Muc2hpZnQoKS5zbGljZSgxKSk7XG4gICAgfVxuICAgIC8vIElmIHRoZSBjb21tYW5kIGV4aXN0cywgKipBTkQqKiB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiwgcnVuIGl0LlxuICAgIGNsaWVudC5sb2dnZXIuY21kKFxuICAgICAgICBgJHtjbGllbnQuY29uZmlnLnBlcm1MZXZlbHMuZmluZCgobCkgPT4gbC5sZXZlbCA9PT0gbGV2ZWwpLm5hbWV9ICR7XG4gICAgICAgICAgICBtZXNzYWdlLmF1dGhvci51c2VybmFtZVxuICAgICAgICB9ICgke21lc3NhZ2UuYXV0aG9yLmlkfSkgcmFuIGNvbW1hbmQgJHtjbWQuaGVscC5uYW1lfWBcbiAgICApO1xuICAgIGNtZC5ydW4oY2xpZW50LCBtZXNzYWdlLCBhcmdzLCBsZXZlbCk7XG59O1xuIl19